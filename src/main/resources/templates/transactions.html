<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DemoBank - Transaction History</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">üè¶ DemoBank</div>
            <nav class="nav">
                <a th:href="@{/dashboard}">Dashboard</a>
                <a th:href="@{/accounts}">Accounts</a>
                <a th:href="@{/transfer}">Transfer</a>
                <a th:href="@{/transactions}" class="active">Transactions</a>
                <a th:href="@{/credit-application}">Credit Card</a>
                <a th:href="@{/search}">Search</a>
                <span th:text="'Welcome, ' + ${user.firstName}"></span>
                <a th:href="@{/logout}">Logout</a>
            </nav>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <h1>Transaction History</h1>
            <p style="color: #666; margin-bottom: 2rem;">View and search your transaction history</p>
        </div>

        <!-- Filter Section -->
        <div class="card">
            <h2 style="margin-bottom: 1.5rem;">Search & Filter Transactions</h2>
            <form th:action="@{/transactions/search}" method="post">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                    
                    <!-- Transaction Type Filter -->
                    <div class="form-group">
                        <label for="transactionType">Transaction Type</label>
                        <select id="transactionType" name="transactionType" class="form-control" 
                                th:value="${filters != null ? filters['transactionType'] : ''}">
                            <option value="ALL">All Types</option>
                            <option value="TRANSFER_OUT" th:selected="${filters != null && filters['transactionType'] == 'TRANSFER_OUT'}">Transfers Out</option>
                            <option value="TRANSFER_IN" th:selected="${filters != null && filters['transactionType'] == 'TRANSFER_IN'}">Transfers In</option>
                            <option value="DEPOSIT" th:selected="${filters != null && filters['transactionType'] == 'DEPOSIT'}">Deposits</option>
                            <option value="WITHDRAWAL" th:selected="${filters != null && filters['transactionType'] == 'WITHDRAWAL'}">Withdrawals</option>
                        </select>
                    </div>

                    <!-- Min Amount Filter -->
                    <div class="form-group">
                        <label for="minAmount">Min Amount</label>
                        <input type="number" id="minAmount" name="minAmount" class="form-control" 
                               placeholder="0.00" step="0.01" min="0"
                               th:value="${filters != null ? filters['minAmount'] : ''}">
                    </div>

                    <!-- Max Amount Filter -->
                    <div class="form-group">
                        <label for="maxAmount">Max Amount</label>
                        <input type="number" id="maxAmount" name="maxAmount" class="form-control" 
                               placeholder="10000.00" step="0.01" min="0"
                               th:value="${filters != null ? filters['maxAmount'] : ''}">
                    </div>

                    <!-- Start Date Filter -->
                    <div class="form-group">
                        <label for="startDate">Start Date</label>
                        <input type="date" id="startDate" name="startDate" class="form-control"
                               th:value="${filters != null ? filters['startDate'] : ''}">
                    </div>

                    <!-- End Date Filter -->
                    <div class="form-group">
                        <label for="endDate">End Date</label>
                        <input type="date" id="endDate" name="endDate" class="form-control"
                               th:value="${filters != null ? filters['endDate'] : ''}">
                    </div>

                    <!-- Description Search -->
                    <div class="form-group">
                        <label for="description">Description</label>
                        <input type="text" id="description" name="description" class="form-control" 
                               placeholder="Search description..."
                               th:value="${filters != null ? filters['description'] : ''}">
                    </div>
                </div>

                <div style="display: flex; gap: 1rem;">
                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                    <a th:href="@{/transactions}" class="btn btn-secondary">Clear Filters</a>
                </div>
            </form>
        </div>

        <!-- Transactions Table -->
        <div class="card">
            <h2 style="margin-bottom: 1.5rem;">
                Transactions 
                <span th:if="${transactions != null}" th:text="'(' + ${transactions.size()} + ' found)'" 
                      style="font-size: 0.9rem; color: #666;"></span>
            </h2>
            
            <div th:if="${transactions == null || transactions.isEmpty()}" 
                 style="text-align: center; padding: 3rem; color: #666;">
                <p style="font-size: 1.1rem;">No transactions found.</p>
                <p style="font-size: 0.9rem;">Try adjusting your filters or make a transfer to see transactions here.</p>
            </div>

            <div th:if="${transactions != null && !transactions.isEmpty()}" style="overflow-x: auto;">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Type</th>
                            <th>Account</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="transaction : ${transactions}">
                            <td th:text="${#temporals.format(transaction.transactionDate, 'MMM dd, yyyy HH:mm')}"></td>
                            <td>
                                <span th:if="${transaction.transactionType == 'TRANSFER_OUT'}" 
                                      style="background: #dc3545; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">
                                    Transfer Out
                                </span>
                                <span th:if="${transaction.transactionType == 'TRANSFER_IN'}" 
                                      style="background: #28a745; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">
                                    Transfer In
                                </span>
                                <span th:if="${transaction.transactionType == 'DEPOSIT'}" 
                                      style="background: #17a2b8; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">
                                    Deposit
                                </span>
                                <span th:if="${transaction.transactionType == 'WITHDRAWAL'}" 
                                      style="background: #ffc107; color: #333; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">
                                    Withdrawal
                                </span>
                            </td>
                            <td>
                                <div th:if="${accountMap.get(transaction.accountId) != null}">
                                    <div th:text="${accountMap.get(transaction.accountId).accountType}" 
                                         style="font-weight: 600;"></div>
                                    <div th:text="${accountMap.get(transaction.accountId).accountNumber}" 
                                         style="font-size: 0.85rem; color: #666;"></div>
                                </div>
                                <div th:unless="${accountMap.get(transaction.accountId) != null}">
                                    <div style="color: #999;">Unknown Account</div>
                                </div>
                            </td>
                            <td th:text="${transaction.description}"></td>
                            <td>
                                <span th:if="${transaction.transactionType == 'TRANSFER_OUT' || transaction.transactionType == 'WITHDRAWAL'}" 
                                      th:text="'-$' + ${#numbers.formatDecimal(transaction.amount, 0, 'COMMA', 2, 'POINT')}"
                                      style="color: #dc3545; font-weight: 600;">
                                </span>
                                <span th:if="${transaction.transactionType == 'TRANSFER_IN' || transaction.transactionType == 'DEPOSIT'}" 
                                      th:text="'+$' + ${#numbers.formatDecimal(transaction.amount, 0, 'COMMA', 2, 'POINT')}"
                                      style="color: #28a745; font-weight: 600;">
                                </span>
                            </td>
                            <td>
                                <span th:if="${transaction.status == 'COMPLETED'}" 
                                      style="color: #28a745;">‚úì Completed</span>
                                <span th:if="${transaction.status == 'PENDING'}" 
                                      style="color: #ffc107;">‚è≥ Pending</span>
                                <span th:if="${transaction.status == 'FAILED'}" 
                                      style="color: #dc3545;">‚úó Failed</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Quick Stats -->
            <div th:if="${transactions != null && !transactions.isEmpty()}" 
                 style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e0e0e0;">
                <h3 style="margin-bottom: 1rem;">Summary</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 0.85rem; color: #666; margin-bottom: 0.5rem;">Total Transactions</div>
                        <div style="font-size: 1.5rem; font-weight: 700;" th:text="${transactions.size()}"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .form-group {
            margin-bottom: 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }
        .form-control {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        .active {
            font-weight: 700;
            text-decoration: underline;
        }
    </style>
</body>
</html>

